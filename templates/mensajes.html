<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéÇ Mensajes Especiales</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #fbe9e7 0%, #f8bbd9 50%, #e1bee7 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        /* Animaci√≥n de confeti de fondo */
        body::before {
            content: '';
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-image: 
                radial-gradient(circle at 20% 50%, #ff6b6b 2px, transparent 2px),
                radial-gradient(circle at 80% 50%, #4ecdc4 2px, transparent 2px),
                radial-gradient(circle at 40% 20%, #45b7d1 2px, transparent 2px),
                radial-gradient(circle at 60% 80%, #f9ca24 2px, transparent 2px),
                radial-gradient(circle at 90% 30%, #6c5ce7 2px, transparent 2px),
                radial-gradient(circle at 10% 70%, #a29bfe 2px, transparent 2px);
            background-size: 100px 100px, 120px 120px, 90px 90px, 110px 110px, 80px 80px, 130px 130px;
            animation: confetti-fall 20s linear infinite;
            pointer-events: none;
            z-index: -1;
        }

        @keyframes confetti-fall {
            0% { transform: translateY(-100px) rotate(0deg); }
            100% { transform: translateY(100vh) rotate(360deg); }
        }

        .container {
            max-width: 800px;
            margin: 0 auto;
            text-align: center;
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 40px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 192, 203, 0.3);
        }

        h1 {
            font-size: 3rem;
            color: #e91e63;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
            animation: bounce 2s ease-in-out infinite alternate;
        }

        @keyframes bounce {
            from { transform: translateY(0px); }
            to { transform: translateY(-10px); }
        }

        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }

        .cake-container {
            margin: 40px 0;
            padding: 30px;
            background: linear-gradient(145deg, #fff, #f0f0f0);
            border-radius: 20px;
            box-shadow: inset 5px 5px 15px rgba(0, 0, 0, 0.05);
        }

        .generate-btn {
            background: linear-gradient(45deg, #ff6b6b, #ffa726);
            color: white;
            border: none;
            padding: 18px 40px;
            font-size: 1.3rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(255, 107, 107, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .generate-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .generate-btn:hover::before {
            left: 100%;
        }

        .generate-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(255, 107, 107, 0.4);
        }

        .generate-btn:active {
            transform: translateY(-1px);
        }

        .generate-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .loading {
            display: none;
            margin: 20px 0;
        }

        .loading-spinner {
            border: 4px solid #f3f3f3;
            border-top: 4px solid #ff6b6b;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .loading-text {
            margin-top: 15px;
            color: #666;
            font-weight: bold;
        }

        .cake-display {
            margin-top: 30px;
            padding: 20px;
            background: #fff;
            border-radius: 15px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            display: none;
        }

        .cake-image {
            max-width: 100%;
            height: auto;
            border-radius: 15px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            transition: transform 0.3s ease;
        }

        .cake-image:hover {
            transform: scale(1.05);
        }

        .success-message {
            background: linear-gradient(45deg, #4caf50, #66bb6a);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
            display: none;
        }

        .error-message {
            background: linear-gradient(45deg, #f44336, #ef5350);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
            display: none;
        }

        .back-btn {
            display: inline-block;
            padding: 15px 35px;
            background: linear-gradient(45deg, #9c27b0, #ba68c8);
            color: white;
            text-decoration: none;
            border-radius: 50px;
            font-weight: bold;
            font-size: 1.1rem;
            box-shadow: 0 6px 15px rgba(156, 39, 176, 0.3);
            transition: all 0.3s ease;
            margin-top: 30px;
        }

        .back-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 8px 20px rgba(156, 39, 176, 0.4);
            text-decoration: none;
            color: white;
        }

        .birthday-message {
            background: linear-gradient(45deg, #ff9a9e, #fecfef);
            padding: 25px;
            border-radius: 15px;
            margin: 30px 0;
            border-left: 5px solid #e91e63;
        }

        .birthday-message h3 {
            color: #e91e63;
            margin-bottom: 10px;
            font-size: 1.5rem;
        }

        .birthday-message p {
            color: #666;
            font-size: 1.1rem;
            line-height: 1.6;
        }

        /* Efectos de part√≠culas */
        .particle {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
        }

        @media (max-width: 768px) {
            .container {
                margin: 10px;
                padding: 20px;
            }
            
            h1 {
                font-size: 2rem;
            }
            
            .generate-btn {
                padding: 15px 30px;
                font-size: 1.1rem;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üéâ Mensajes Especiales</h1>
        <p class="subtitle">Crea recuerdos m√°gicos con pasteles √∫nicos hechos especialmente para ti</p>
        
        <div class="birthday-message">
            <h3>üéÇ ¬°Feliz Cumplea√±os!</h3>
            <p>Cada pastel es una obra de arte unica como t√∫, llena de colores vibrantes, velas brillantes y toda la magia que mereces en tu d√≠a especial.</p>
        </div>

        <div class="cake-container">
            <button onclick="generarPastel()" id="generateBtn" class="generate-btn">
                üéÇ Hornear Mi Pastel M√°gico
            </button>
            
            <div class="loading" id="loading">
                <div class="loading-spinner"></div>
                <div class="loading-text">Preparando tu pastel especial... üé®</div>
            </div>
            
            <div class="success-message" id="successMessage">
                ¬°Tu pastel est√° listo! üéâ ¬°Que tengas un d√≠a incre√≠ble!
            </div>
            
            <div class="error-message" id="errorMessage">
                Ups, algo sali√≥ mal. Int√©ntalo de nuevo en un momento.
            </div>
            
            <div class="cake-display" id="cakeDisplay">
                <div id="imagenPastel"></div>
            </div>
        </div>

        <a href="/" class="back-btn">‚Üê Volver al Inicio</a>
    </div>

    <script>
        function generarPastel() {
            const btn = document.getElementById('generateBtn');
            const loading = document.getElementById('loading');
            const successMsg = document.getElementById('successMessage');
            const errorMsg = document.getElementById('errorMessage');
            const cakeDisplay = document.getElementById('cakeDisplay');
            
            // Resetear estados
            btn.disabled = true;
            btn.textContent = 'Generando...';
            loading.style.display = 'block';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';
            cakeDisplay.style.display = 'none';
            
            // Crear efecto de part√≠culas
            createParticles();
            
            fetch('/generate_cake')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        const contenedor = document.getElementById('imagenPastel');
                        contenedor.innerHTML = `
                            <img src="${data.image_url}" alt="Pastel de Cumplea√±os" class="cake-image">
                            <p style="margin-top: 15px; color: #666; font-style: italic;">
                                ${data.message}
                            </p>
                        `;
                        
                        successMsg.style.display = 'block';
                        cakeDisplay.style.display = 'block';
                        
                        // Efecto de confeti
                        launchConfetti();
                        
                    } else {
                        errorMsg.textContent = data.error || 'Error desconocido';
                        errorMsg.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    errorMsg.textContent = 'Error de conexi√≥n. Verifica tu internet.';
                    errorMsg.style.display = 'block';
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.textContent = 'üéÇ Crear Otro Pastel';
                    loading.style.display = 'none';
                });
        }
        
        function createParticles() {
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#6c5ce7', '#a29bfe'];
            
            for (let i = 0; i < 20; i++) {
                setTimeout(() => {
                    const particle = document.createElement('div');
                    particle.className = 'particle';
                    particle.style.left = Math.random() * window.innerWidth + 'px';
                    particle.style.top = Math.random() * window.innerHeight + 'px';
                    particle.style.width = (Math.random() * 10 + 5) + 'px';
                    particle.style.height = particle.style.width;
                    particle.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    particle.style.borderRadius = '50%';
                    particle.style.animation = 'float 3s ease-out forwards';
                    
                    document.body.appendChild(particle);
                    
                    setTimeout(() => {
                        particle.remove();
                    }, 3000);
                }, i * 100);
            }
        }
        
        function launchConfetti() {
            const duration = 3000;
            const colors = ['#ff6b6b', '#4ecdc4', '#45b7d1', '#f9ca24', '#6c5ce7', '#a29bfe'];
            
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confetti = document.createElement('div');
                    confetti.style.position = 'fixed';
                    confetti.style.left = Math.random() * window.innerWidth + 'px';
                    confetti.style.top = '-10px';
                    confetti.style.width = (Math.random() * 8 + 4) + 'px';
                    confetti.style.height = confetti.style.width;
                    confetti.style.backgroundColor = colors[Math.floor(Math.random() * colors.length)];
                    confetti.style.borderRadius = Math.random() > 0.5 ? '50%' : '0';
                    confetti.style.pointerEvents = 'none';
                    confetti.style.zIndex = '1000';
                    confetti.style.animation = `confetti-fall 3s linear forwards`;
                    
                    document.body.appendChild(confetti);
                    
                    setTimeout(() => {
                        confetti.remove();
                    }, 3000);
                }, i * 60);
            }
        }
        
        // Agregar estilos CSS din√°micamente para las animaciones
        const style = document.createElement('style');
        style.textContent = `
            @keyframes float {
                0% { 
                    transform: translateY(0px) rotate(0deg);
                    opacity: 1;
                }
                100% { 
                    transform: translateY(-100px) rotate(360deg);
                    opacity: 0;
                }
            }
        `;
        document.head.appendChild(style);
    </script>
<br>
<br>

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üéµ Generador de Lyrics Animadas</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            position: relative;
            overflow-x: hidden;
        }

        .container {
            max-width: 900px;
            margin: 0 auto;
            text-align: center;
        }

        .song-section {
            background: rgba(255, 255, 255, 0.95);
            border-radius: 25px;
            padding: 40px;
            margin: 30px 0;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            backdrop-filter: blur(10px);
            border: 2px solid rgba(255, 255, 255, 0.3);
        }

        h2 {
            font-size: 2.5rem;
            color: #6a1b9a;
            margin-bottom: 20px;
            text-shadow: 2px 2px 4px rgba(0, 0, 0, 0.1);
        }

        .subtitle {
            font-size: 1.2rem;
            color: #666;
            margin-bottom: 30px;
            font-style: italic;
        }

        .song-controls {
            display: flex;
            gap: 20px;
            justify-content: center;
            flex-wrap: wrap;
            margin-bottom: 30px;
        }

        .song-btn {
            background: linear-gradient(45deg, #6a1b9a, #9c27b0);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 1.1rem;
            font-weight: bold;
            border-radius: 50px;
            cursor: pointer;
            box-shadow: 0 8px 20px rgba(106, 27, 154, 0.3);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }

        .song-btn::before {
            content: '';
            position: absolute;
            top: 0;
            left: -100%;
            width: 100%;
            height: 100%;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.2), transparent);
            transition: left 0.5s;
        }

        .song-btn:hover::before {
            left: 100%;
        }

        .song-btn:hover {
            transform: translateY(-3px);
            box-shadow: 0 12px 25px rgba(106, 27, 154, 0.4);
        }

        .song-btn:disabled {
            background: #ccc;
            cursor: not-allowed;
            transform: none;
        }

        .custom-lyrics {
            margin: 20px 0;
        }

        .custom-lyrics textarea {
            width: 100%;
            height: 120px;
            padding: 15px;
            border: 2px solid #ddd;
            border-radius: 15px;
            font-family: inherit;
            font-size: 1rem;
            resize: vertical;
            transition: border-color 0.3s ease;
        }

        .custom-lyrics textarea:focus {
            outline: none;
            border-color: #6a1b9a;
        }

        .song-display {
            margin-top: 30px;
            padding: 30px;
            border-radius: 20px;
            min-height: 400px;
            position: relative;
            display: none;
            overflow: hidden;
        }

        .song-title {
            font-size: 2rem;
            font-weight: bold;
            margin-bottom: 30px;
            opacity: 0;
            transform: translateY(-20px);
            animation: fadeInTitle 1s ease-out forwards;
        }

        .lyric-line {
            font-size: 1.4rem;
            font-weight: 500;
            margin: 20px 0;
            opacity: 0;
            transform: translateX(-50px);
            line-height: 1.6;
            letter-spacing: 0.5px;
        }

        .lyric-line.active {
            animation: fadeInSlide 0.5s ease-out forwards;
        }

        .progress-bar {
            width: 100%;
            height: 6px;
            background: rgba(255, 255, 255, 0.3);
            border-radius: 3px;
            overflow: hidden;
            margin-top: 30px;
        }

        .progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #fff, #f0f0f0);
            border-radius: 3px;
            width: 0%;
            transition: width 0.3s ease;
        }

        .song-controls-playing {
            position: absolute;
            top: 20px;
            right: 20px;
            display: flex;
            gap: 10px;
        }

        .control-btn {
            background: rgba(255, 255, 255, 0.2);
            border: none;
            color: white;
            padding: 10px 15px;
            border-radius: 25px;
            cursor: pointer;
            font-size: 0.9rem;
            transition: all 0.3s ease;
        }

        .control-btn:hover {
            background: rgba(255, 255, 255, 0.3);
            transform: scale(1.05);
        }

        .loading-song {
            display: none;
            margin: 20px 0;
        }

        .loading-song-spinner {
            border: 4px solid rgba(106, 27, 154, 0.3);
            border-top: 4px solid #6a1b9a;
            border-radius: 50%;
            width: 50px;
            height: 50px;
            animation: spin 1s linear infinite;
            margin: 0 auto;
        }

        .loading-song-text {
            margin-top: 15px;
            color: #666;
            font-weight: bold;
        }

        .success-message-song {
            background: linear-gradient(45deg, #4caf50, #66bb6a);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
            display: none;
        }

        .error-message-song {
            background: linear-gradient(45deg, #f44336, #ef5350);
            color: white;
            padding: 15px;
            border-radius: 10px;
            margin: 20px 0;
            font-weight: bold;
            display: none;
        }

        @keyframes fadeInTitle {
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }

        @keyframes fadeInSlide {
            to {
                opacity: 1;
                transform: translateX(0);
            }
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.02); }
        }

        .floating-notes {
            position: fixed;
            pointer-events: none;
            z-index: 1000;
            font-size: 2rem;
            color: rgba(255, 255, 255, 0.7);
            animation: floatUp 4s ease-out forwards;
        }

        @keyframes floatUp {
            0% {
                transform: translateY(0px) rotate(0deg);
                opacity: 1;
            }
            100% {
                transform: translateY(-100px) rotate(360deg);
                opacity: 0;
            }
        }

        @media (max-width: 768px) {
            .song-section {
                margin: 10px;
                padding: 20px;
            }
            
            h2 {
                font-size: 2rem;
            }
            
            .song-controls {
                flex-direction: column;
                align-items: center;
            }
            
            .song-btn {
                width: 100%;
                max-width: 300px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="song-section">
            <h2>üéµ Generador de Canciones Animadas</h2>
            <p class="subtitle">Ahora que comimos el pastel, es tiempo de cantar una canci√≥n</p>
            
            <div class="song-controls">
                <button onclick="generateRandomSong()" id="randomSongBtn" class="song-btn">
                    üé≤ Canci√≥n Aleatoria
                </button>
                <button onclick="toggleCustomLyrics()" id="customBtn" class="song-btn">
                    ‚úçÔ∏è Crear Personalizada
                </button>
                <button onclick="stopSong()" id="stopBtn" class="song-btn" style="display: none;">
                    ‚èπÔ∏è Detener
                </button>
            </div>

            <div class="custom-lyrics" id="customLyricsSection" style="display: none;">
                <textarea id="customLyricsInput" placeholder="Escribe aqu√≠ las letras de tu canci√≥n personalizada...&#10;&#10;Ejemplo:&#10;Esta es mi canci√≥n especial&#10;Llena de amor y alegr√≠a&#10;Cada palabra tiene sentido&#10;En este d√≠a tan especial"></textarea>
                <button onclick="createCustomSong()" id="createCustomBtn" class="song-btn">
                    üéµ Crear Mi Canci√≥n
                </button>
            </div>
            
            <div class="loading-song" id="loadingSong">
                <div class="loading-song-spinner"></div>
                <div class="loading-song-text">Preparando tu canci√≥n m√°gica... üéº</div>
            </div>
            
            <div class="success-message-song" id="successMessageSong">
                ¬°Tu canci√≥n est√° lista! üéâ ¬°Disfruta la experiencia musical!
            </div>
            
            <div class="error-message-song" id="errorMessageSong">
                Ups, algo sali√≥ mal con la canci√≥n. Int√©ntalo de nuevo.
            </div>
            
            <div class="song-display" id="songDisplay">
                <div class="song-controls-playing">
                    <button onclick="pauseResumeSong()" id="pauseBtn" class="control-btn">‚è∏Ô∏è Pausa</button>
                    <button onclick="restartSong()" id="restartBtn" class="control-btn">‚èÆÔ∏è Reiniciar</button>
                </div>
                
                <div class="song-title" id="songTitle">T√≠tulo de la Canci√≥n</div>
                <div id="lyricsContainer"></div>
                
                <div class="progress-bar">
                    <div class="progress-fill" id="progressFill"></div>
                </div>
            </div>
        </div>
    </div>

    <script>
        let currentSong = null;
        let songTimeouts = [];
        let isPaused = false;
        let startTime = 0;
        let pausedTime = 0;

        function generateRandomSong() {
            const btn = document.getElementById('randomSongBtn');
            const loading = document.getElementById('loadingSong');
            const successMsg = document.getElementById('successMessageSong');
            const errorMsg = document.getElementById('errorMessageSong');
            const songDisplay = document.getElementById('songDisplay');
            
            // Resetear estados
            resetSongState();
            btn.disabled = true;
            btn.textContent = 'Generando...';
            loading.style.display = 'block';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';
            songDisplay.style.display = 'none';
            
            // Crear efecto de notas flotantes
            createFloatingNotes();
            
            fetch('/generate_song')
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        currentSong = data.song_data;
                        setupSongDisplay(currentSong);
                        successMsg.style.display = 'block';
                        startSong();
                    } else {
                        errorMsg.textContent = data.error || 'Error desconocido';
                        errorMsg.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    errorMsg.textContent = 'Error de conexi√≥n. Verifica tu internet.';
                    errorMsg.style.display = 'block';
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.textContent = 'üé≤ Otra Canci√≥n';
                    loading.style.display = 'none';
                });
        }

        function toggleCustomLyrics() {
            const section = document.getElementById('customLyricsSection');
            const btn = document.getElementById('customBtn');
            
            if (section.style.display === 'none') {
                section.style.display = 'block';
                btn.textContent = '‚ùå Cancelar';
            } else {
                section.style.display = 'none';
                btn.textContent = '‚úçÔ∏è Crear Personalizada';
            }
        }

        function createCustomSong() {
            const customLyrics = document.getElementById('customLyricsInput').value.trim();
            
            if (!customLyrics) {
                alert('Por favor escribe las letras de tu canci√≥n personalizada.');
                return;
            }

            const btn = document.getElementById('createCustomBtn');
            const loading = document.getElementById('loadingSong');
            const successMsg = document.getElementById('successMessageSong');
            const errorMsg = document.getElementById('errorMessageSong');
            const songDisplay = document.getElementById('songDisplay');
            
            // Resetear estados
            resetSongState();
            btn.disabled = true;
            btn.textContent = 'Creando...';
            loading.style.display = 'block';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';
            songDisplay.style.display = 'none';
            
            fetch('/create_custom_song', {
                method: 'POST',
                headers: {
                    'Content-Type': 'application/json',
                },
                body: JSON.stringify({
                    custom_lyrics: customLyrics
                })
            })
                .then(response => response.json())
                .then(data => {
                    if (data.success) {
                        currentSong = data.song_data;
                        setupSongDisplay(currentSong);
                        successMsg.style.display = 'block';
                        toggleCustomLyrics(); // Ocultar el formulario
                        startSong();
                    } else {
                        errorMsg.textContent = data.error || 'Error desconocido';
                        errorMsg.style.display = 'block';
                    }
                })
                .catch(error => {
                    console.error('Error:', error);
                    errorMsg.textContent = 'Error de conexi√≥n. Verifica tu internet.';
                    errorMsg.style.display = 'block';
                })
                .finally(() => {
                    btn.disabled = false;
                    btn.textContent = 'üéµ Crear Mi Canci√≥n';
                    loading.style.display = 'none';
                });
        }

        function setupSongDisplay(songData) {
            const songDisplay = document.getElementById('songDisplay');
            const songTitle = document.getElementById('songTitle');
            const lyricsContainer = document.getElementById('lyricsContainer');
            
            // Configurar colores
            songDisplay.style.backgroundColor = songData.background_color;
            songDisplay.style.color = songData.text_color;
            songDisplay.style.display = 'block';
            
            // Configurar t√≠tulo
            songTitle.textContent = songData.title;
            
            // Limpiar letras anteriores
            lyricsContainer.innerHTML = '';
            
            // Crear elementos para cada l√≠nea
            songData.lyrics.forEach((lyric, index) => {
                const lyricElement = document.createElement('div');
                lyricElement.className = 'lyric-line';
                lyricElement.textContent = lyric[0];
                lyricElement.id = `lyric-${index}`;
                lyricsContainer.appendChild(lyricElement);
            });
        }

        function startSong() {
            if (!currentSong) return;
            
            document.getElementById('stopBtn').style.display = 'inline-block';
            document.getElementById('pauseBtn').style.display = 'inline-block';
            document.getElementById('restartBtn').style.display = 'inline-block';
            
            startTime = Date.now();
            isPaused = false;
            
            // Animar cada l√≠nea
            currentSong.lyrics.forEach((lyric, index) => {
                const delay = currentSong.delays[index] * 1000; // Convertir a milisegundos
                const speed = lyric[1] * 1000; // Velocidad de escritura
                
                const timeout = setTimeout(() => {
                    if (!isPaused) {
                        animateLyric(index, lyric[0], speed);
                    }
                }, delay);
                
                songTimeouts.push(timeout);
            });
            
            // Actualizar barra de progreso
            updateProgressBar();
        }

        function animateLyric(index, text, speed) {
            const lyricElement = document.getElementById(`lyric-${index}`);
            if (!lyricElement) return;
            
            lyricElement.classList.add('active');
            lyricElement.textContent = '';
            
            let charIndex = 0;
            const typeInterval = setInterval(() => {
                if (isPaused) {
                    clearInterval(typeInterval);
                    return;
                }
                
                lyricElement.textContent += text[charIndex];
                charIndex++;
                
                if (charIndex >= text.length) {
                    clearInterval(typeInterval);
                }
            }, speed);
        }

        function updateProgressBar() {
            const progressFill = document.getElementById('progressFill');
            const totalDuration = currentSong.total_duration * 1000;
            
            const progressInterval = setInterval(() => {
                if (isPaused) return;
                
                const elapsed = Date.now() - startTime;
                const progress = Math.min((elapsed / totalDuration) * 100, 100);
                progressFill.style.width = progress + '%';
                
                if (progress >= 100) {
                    clearInterval(progressInterval);
                    setTimeout(() => {
                        document.getElementById('stopBtn').style.display = 'none';
                    }, 2000);
                }
            }, 100);
        }

        function pauseResumeSong() {
            const pauseBtn = document.getElementById('pauseBtn');
            
            if (isPaused) {
                // Reanudar
                isPaused = false;
                pauseBtn.textContent = '‚è∏Ô∏è Pausa';
                startTime = Date.now() - pausedTime;
                // Reanudar animaciones pendientes
                restartPendingAnimations();
            } else {
                // Pausar
                isPaused = true;
                pauseBtn.textContent = '‚ñ∂Ô∏è Continuar';
                pausedTime = Date.now() - startTime;
            }
        }

        function restartSong() {
            resetSongState();
            if (currentSong) {
                setupSongDisplay(currentSong);
                startSong();
            }
        }

        function stopSong() {
            resetSongState();
            document.getElementById('songDisplay').style.display = 'none';
            document.getElementById('stopBtn').style.display = 'none';
        }

        function resetSongState() {
            // Limpiar timeouts
            songTimeouts.forEach(timeout => clearTimeout(timeout));
            songTimeouts = [];
            
            // Resetear variables
            isPaused = false;
            startTime = 0;
            pausedTime = 0;// Limpiar elementos de progreso
            document.getElementById('progressFill').style.width = '0%';
            
            // Ocultar controles
            document.getElementById('pauseBtn').style.display = 'none';
            document.getElementById('restartBtn').style.display = 'none';
        }

        function restartPendingAnimations() {
            if (!currentSong) return;
            
            // Limpiar cualquier animaci√≥n activa antes de reiniciar
            clearAllAnimations();
            
            const currentTime = Date.now() - startTime;
            
            currentSong.lyrics.forEach((lyric, index) => {
                const delay = currentSong.delays[index] * 1000;
                const speed = lyric[1] * 1000;
                
                const lyricElement = document.getElementById(`lyric-${index}`);
                if (!lyricElement) return;
                
                if (delay > currentTime) {
                    // Esta animaci√≥n a√∫n no ha comenzado
                    const remainingDelay = delay - currentTime;
                    const timeout = setTimeout(() => {
                        if (!isPaused) {
                            animateLyric(index, lyric[0], speed);
                        }
                    }, remainingDelay);
                    
                    songTimeouts.push(timeout);
                } else {
                    // Esta l√≠nea ya deber√≠a estar visible, verificar si necesita continuar anim√°ndose
                    const timeSinceStart = currentTime - delay;
                    const expectedChars = Math.floor(timeSinceStart / speed);
                    const fullText = lyric[0];
                    
                    if (expectedChars < fullText.length) {
                        // Continuar la animaci√≥n desde donde se paus√≥
                        const currentText = fullText.substring(0, expectedChars);
                        lyricElement.textContent = currentText;
                        lyricElement.classList.add('active');
                        
                        // Continuar escribiendo el resto del texto
                        let charIndex = expectedChars;
                        const typeInterval = setInterval(() => {
                            if (isPaused) {
                                clearInterval(typeInterval);
                                return;
                            }
                            
                            if (charIndex < fullText.length) {
                                lyricElement.textContent += fullText[charIndex];
                                charIndex++;
                            } else {
                                clearInterval(typeInterval);
                                const intervalIndex = activeIntervals.indexOf(typeInterval);
                                if (intervalIndex > -1) {
                                    activeIntervals.splice(intervalIndex, 1);
                                }
                            }
                        }, speed);
                        
                        activeIntervals.push(typeInterval);
                    } else {
                        // La l√≠nea ya deber√≠a estar completamente visible
                        lyricElement.textContent = fullText;
                        lyricElement.classList.add('active');
                    }
                }
            });
        }

        function createFloatingNotes() {
            const notes = ['üéµ', 'üé∂', '‚ô™', '‚ô´', 'üéº', 'üé§'];
            const container = document.body;
            
            for (let i = 0; i < 8; i++) {
                setTimeout(() => {
                    const note = document.createElement('div');
                    note.className = 'floating-notes';
                    note.textContent = notes[Math.floor(Math.random() * notes.length)];
                    note.style.left = Math.random() * window.innerWidth + 'px';
                    note.style.top = window.innerHeight + 'px';
                    
                    container.appendChild(note);
                    
                    setTimeout(() => {
                        container.removeChild(note);
                    }, 4000);
                }, i * 200);
            }
        }

        // Funci√≥n para generar efectos visuales durante la reproducci√≥n
        function createVisualEffects() {
            const songDisplay = document.getElementById('songDisplay');
            if (!songDisplay || songDisplay.style.display === 'none') return;
            
            // Crear efecto de pulso sutil
            songDisplay.style.animation = 'pulse 2s ease-in-out infinite';
            
            // Limpiar efecto despu√©s de un tiempo
            setTimeout(() => {
                songDisplay.style.animation = 'none';
            }, 10000);
        }

        // Funci√≥n para manejar errores de red
        function handleNetworkError() {
            const errorMsg = document.getElementById('errorMessageSong');
            errorMsg.textContent = 'Error de conexi√≥n. Verifica tu conexi√≥n a internet e int√©ntalo de nuevo.';
            errorMsg.style.display = 'block';
            
            // Ocultar mensaje despu√©s de 5 segundos
            setTimeout(() => {
                errorMsg.style.display = 'none';
            }, 5000);
        }

        // Funci√≥n para validar entrada personalizada
        function validateCustomLyrics(lyrics) {
            if (!lyrics || lyrics.trim().length === 0) {
                return { valid: false, message: 'Las letras no pueden estar vac√≠as.' };
            }
            
            if (lyrics.length > 2000) {
                return { valid: false, message: 'Las letras son demasiado largas. M√°ximo 2000 caracteres.' };
            }
            
            const lines = lyrics.split('\n').filter(line => line.trim().length > 0);
            if (lines.length === 0) {
                return { valid: false, message: 'Debe haber al menos una l√≠nea con texto.' };
            }
            
            if (lines.length > 20) {
                return { valid: false, message: 'M√°ximo 20 l√≠neas permitidas.' };
            }
            
            return { valid: true };
        }

        // Mejorar la funci√≥n createCustomSong con validaci√≥n
        function createCustomSong() {
            const customLyrics = document.getElementById('customLyricsInput').value.trim();
            
            const validation = validateCustomLyrics(customLyrics);
            if (!validation.valid) {
                alert(validation.message);
                return;
            }

            const btn = document.getElementById('createCustomBtn');
            const loading = document.getElementById('loadingSong');
            const successMsg = document.getElementById('successMessageSong');
            const errorMsg = document.getElementById('errorMessageSong');
            const songDisplay = document.getElementById('songDisplay');
            
            // Resetear estados
            resetSongState();
            btn.disabled = true;
            btn.textContent = 'Creando...';
            loading.style.display = 'block';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';
            songDisplay.style.display = 'none';
            
            // Crear efectos visuales
            createFloatingNotes();
            
            // Simular llamada al backend (ya que no tenemos servidor real)
            setTimeout(() => {
                try {
                    // Procesar letras personalizadas
                    const processedLyrics = [];
                    const delays = [];
                    
                    const lines = customLyrics.split('\n').filter(line => line.trim().length > 0);
                    let currentDelay = 0.5;
                    
                    lines.forEach(line => {
                        const cleanLine = line.trim();
                        if (cleanLine) {
                            const speed = cleanLine.length < 20 ? 0.08 : cleanLine.length < 40 ? 0.06 : 0.04;
                            processedLyrics.push([cleanLine, speed]);
                            delays.push(currentDelay);
                            currentDelay += cleanLine.length * speed + 1.5;
                        }
                    });
                    
                    // Temas de colores aleatorios
                    const colorThemes = [
                        { background: "#3498db", text: "#ffffff" },
                        { background: "#e67e22", text: "#ffffff" },
                        { background: "#1abc9c", text: "#ffffff" },
                        { background: "#34495e", text: "#ecf0f1" },
                        { background: "#8e44ad", text: "#ffffff" },
                        { background: "#e74c3c", text: "#ffffff" },
                        { background: "#27ae60", text: "#ffffff" }
                    ];
                    
                    const theme = colorThemes[Math.floor(Math.random() * colorThemes.length)];
                    
                    currentSong = {
                        title: "Tu Canci√≥n Personalizada",
                        lyrics: processedLyrics,
                        delays: delays,
                        background_color: theme.background,
                        text_color: theme.text,
                        total_duration: currentDelay + 3
                    };
                    
                    setupSongDisplay(currentSong);
                    successMsg.style.display = 'block';
                    toggleCustomLyrics();
                    startSong();
                    
                } catch (error) {
                    console.error('Error:', error);
                    errorMsg.textContent = 'Error al procesar tu canci√≥n personalizada.';
                    errorMsg.style.display = 'block';
                } finally {
                    btn.disabled = false;
                    btn.textContent = 'üéµ Crear Mi Canci√≥n';
                    loading.style.display = 'none';
                }
            }, 1500);
        }

        // Funci√≥n mejorada para canciones aleatorias
        function generateRandomSong() {
    const songs = {
        "motivational": {
            "title": "Canci√≥n Motivacional",
            "lyrics": [
                ["Ya s√© que los recuerdos no siguen la ley de gravedad", 0.07],
                ["Que el tiempo pasa y nos convierte en lo que fuimos", 0.07],
                ["Lo que me aterra comprobar es que la vida va a toda velocidad", 0.07],
                ["No tiene sentido", 0.07],
                ["Me duele la verdad", 0.07],
                ["Que pronto crecimos", 0.07]
            ],
            "delays": [0.3, 3.2, 6.5, 10.0, 12.5, 15.0],
            "background_color": "#2c3e50",
            "text_color": "#ecf0f1"
                },
                "happy_birthday": {
                    "title": "Feliz Cumplea√±os",
                    "lyrics": [
                        ["üéµ Happy birthday to you", 0.08],
                        ["Happy birthday to you", 0.08],
                        ["Happy birthday Nicolle", 0.09],
                        ["Happy birthday to you! üéµ", 0.08],
                        ["üéâ Make a wish!", 0.12],
                        ["Blow out the candles", 0.10],
                        ["May all your dreams", 0.08],
                        ["Come true today! ‚ú®", 0.08]
                    ],
                    "delays": [0.5, 4.0, 8.0, 12.5, 17.0, 20.0, 24.0, 28.0],
                    "background_color": "#e74c3c",
                    "text_color": "#ffffff"
                },
                "celebration": {
            "title": "Celebraci√≥n",
            "lyrics": [
                ["Alzar√© mis ojos a los montes", 0.08],
                ["Te ver√© radiante como el sol", 0.08],
                ["Seguir√© el brillo de tu gracia", 0.08],
                ["Porque s√© que T√∫ sigues siendo Dios", 0.08],
                ["T√∫ sigues siendo Diooooos", 0.10]
            ],
            "delays": [0.5, 3.5, 7.0, 10.5, 14.0],
            "background_color": "#9b59b6",
            "text_color": "#ffffff"
                },
                "friendship": {
            "title": "Amistad",
            "lyrics": [
                ["Porque un amigo es una luz", 0.08],
                ["Brillando en la oscuridad", 0.08],
                ["Siempre ser√°s mi amigaaa", 0.08],
                ["No importa nada m√°s", 0.08],
                ["Porque siempre estar√°n en m√≠", 0.09],
                ["Esos buenos momentos que pasamos sin saber", 0.08]
            ],
            "delays": [0.5, 4.0, 8.0, 12.0, 16.0, 19.5],
            "background_color": "#27ae60",
            "text_color": "#ffffff"
                }
            };

            const btn = document.getElementById('randomSongBtn');
            const loading = document.getElementById('loadingSong');
            const successMsg = document.getElementById('successMessageSong');
            const errorMsg = document.getElementById('errorMessageSong');
            const songDisplay = document.getElementById('songDisplay');
            
            resetSongState();
            btn.disabled = true;
            btn.textContent = 'Generando...';
            loading.style.display = 'block';
            successMsg.style.display = 'none';
            errorMsg.style.display = 'none';
            songDisplay.style.display = 'none';
            
            createFloatingNotes();
            
            setTimeout(() => {
                try {
                    const songKeys = Object.keys(songs);
                    const randomKey = songKeys[Math.floor(Math.random() * songKeys.length)];
                    const selectedSong = songs[randomKey];
                    
                    currentSong = {
                        title: selectedSong.title,
                        lyrics: selectedSong.lyrics,
                        delays: selectedSong.delays,
                        background_color: selectedSong.background_color,
                        text_color: selectedSong.text_color,
                        total_duration: Math.max(...selectedSong.delays) + 5
                    };
                    
                    setupSongDisplay(currentSong);
                    successMsg.style.display = 'block';
                    startSong();
                    
                } catch (error) {
                    console.error('Error:', error);
                    errorMsg.textContent = 'Error al generar la canci√≥n aleatoria.';
                    errorMsg.style.display = 'block';
                } finally {
                    btn.disabled = false;
                    btn.textContent = 'üé≤ Otra Canci√≥n';
                    loading.style.display = 'none';
                }
            }, 1500);
        }

        // Eventos de teclado para mejor experiencia
        document.addEventListener('keydown', function(event) {
            if (currentSong && document.getElementById('songDisplay').style.display === 'block') {
                switch(event.code) {
                    case 'Space':
                        event.preventDefault();
                        pauseResumeSong();
                        break;
                    case 'KeyR':
                        event.preventDefault();
                        restartSong();
                        break;
                    case 'Escape':
                        event.preventDefault();
                        stopSong();
                        break;
                }
            }
        });

        // Funci√≥n para mejorar la experiencia t√°ctil en m√≥viles
        function addTouchSupport() {
            const songDisplay = document.getElementById('songDisplay');
            let touchStartY = 0;
            let touchEndY = 0;
            
            songDisplay.addEventListener('touchstart', function(e) {
                touchStartY = e.changedTouches[0].screenY;
            });
            
            songDisplay.addEventListener('touchend', function(e) {
                touchEndY = e.changedTouches[0].screenY;
                handleSwipe();
            });
            
            function handleSwipe() {
                const swipeThreshold = 50;
                const diff = touchStartY - touchEndY;
                
                if (Math.abs(diff) > swipeThreshold) {
                    if (diff > 0) {
                        // Swipe up - pausar/reanudar
                        pauseResumeSong();
                    } else {
                        // Swipe down - reiniciar
                        restartSong();
                    }
                }
            }
        }

        // Inicializar funciones adicionales cuando la p√°gina cargue
        document.addEventListener('DOMContentLoaded', function() {
            addTouchSupport();
            
            // Agregar placeholder din√°mico al textarea
            const textarea = document.getElementById('customLyricsInput');
            const placeholders = [
                "Escribe tu canci√≥n especial...\n\nEjemplo:\nEsta es mi canci√≥n especial\nLlena de amor y alegr√≠a\nCada palabra tiene sentido\nEn este d√≠a tan especial",
                "Crea tu propia melod√≠a...\n\nEjemplo:\nHoy es un d√≠a perfecto\nPara cantar y bailar\nLa m√∫sica nos conecta\nY nos hace volar",
                "Expresa tus sentimientos...\n\nEjemplo:\nEn cada nota hay vida\nEn cada verso, pasi√≥n\nLa m√∫sica es medicina\nPara el coraz√≥n"
            ];
            
            let placeholderIndex = 0;
            setInterval(() => {
                if (textarea.value === '') {
                    textarea.placeholder = placeholders[placeholderIndex];
                    placeholderIndex = (placeholderIndex + 1) % placeholders.length;
                }
            }, 5000);
        });

        // Funci√≥n para compartir la canci√≥n (simulada)
        function shareSong() {
            if (currentSong) {
                const shareText = `¬°Mira esta canci√≥n genial: "${currentSong.title}"!`;
                
                if (navigator.share) {
                    navigator.share({
                        title: currentSong.title,
                        text: shareText,
                        url: window.location.href
                    }).catch(console.error);
                } else {
                    // Fallback - copiar al portapapeles
                    navigator.clipboard.writeText(shareText).then(() => {
                        alert('¬°Enlace copiado al portapapeles!');
                    }).catch(() => {
                        alert('No se pudo compartir la canci√≥n.');
                    });
                }
            }
        }
    </script>
</body>




</body>
</html>